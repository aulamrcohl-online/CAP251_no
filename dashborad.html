<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Ejecutivo Analítico</title>
    <!-- Incluir Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Estilos básicos para una mejor presentación -->
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f4f7f6;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: auto;
            background-color: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .chart-container {
            width: 100%;
            height: 400px;
            margin-bottom: 40px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            padding: 20px;
            background-color: #fdfdfd;
        }
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        .card {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.08);
            text-align: center;
        }
        .card-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #555;
            margin-bottom: 10px;
        }
        .card-value {
            font-size: 2em;
            font-weight: bold;
            color: #3498db;
        }
        .highlight {
            color: #e74c3c; /* Rojo para destacar, como en "excede" */
        }
        .info-section {
            text-align: center;
            margin-top: 30px;
            font-style: italic;
            color: #777;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Dashboard Ejecutivo de Tareas</h1>

        <div class="summary-cards">
            <div class="card">
                <div class="card-title">Artista con Más Horas Gastadas</div>
                <div class="card-value" id="artist-max-hours">Cargando...</div>
            </div>
            <div class="card">
                <div class="card-title">Total Horas Presupuestadas (BID)</div>
                <div class="card-value" id="total-bid-hours">Cargando...</div>
            </div>
            <div class="card">
                <div class="card-title">Pipeline Step con Exceso de Horas</div>
                <div class="card-value highlight" id="pipeline-excess">Ninguno</div>
            </div>
        </div>

        <h2>Análisis Detallado</h2>

        <!-- Gráfico 1: Horas BID vs. Horas LOG por Pipeline Step -->
        <div class="chart-container">
            <canvas id="bidVsLogHoursChart"></canvas>
        </div>

        <!-- Gráfico 2: Distribución de Horas LOG por Pipeline Step (Promedio) -->
        <div class="chart-container">
            <canvas id="avgLogHoursPerPipelineChart"></canvas>
        </div>

        <!-- Gráfico 3: Distribución de Horas LOG por Fecha/Mes -->
        <div class="chart-container">
            <canvas id="logHoursByDateChart"></canvas>
        </div>

        <!-- Gráfico 4: Distribución de Status de Tareas -->
        <div class="chart-container">
            <canvas id="taskStatusDistributionChart"></canvas>
        </div>

        <div class="info-section">
            <p>Los datos presentados reflejan la información analizada de las tareas. Consulte los gráficos para obtener una visión más profunda.</p>
        </div>
    </div>

    <script>
        // Datos de ejemplo extraídos de tu imagen
        const data = [
            { id: 45424, link: "ss03_ep001_sq010_sh0010", episodeName: "ss03_ep001", taskName: "Layout", pipelineStep: "Layout", startDate: "23/7/23", dueDate: "29/7/23", duration: 5.00, assignedTo: "Alba Montejano", status: "apr", dateCreated: "4/7/23", bidHoras: 2, timeLog: 1.00, assetType: "Cry Babies", project: "Cry Babies" },
            { id: 45454, link: "ss03_ep001_sq010_sh0020", episodeName: "ss03_ep001", taskName: "Layout", pipelineStep: "Layout", startDate: "23/7/23", dueDate: "29/7/23", duration: 5.00, assignedTo: "Alba Montejano", status: "apr", dateCreated: "4/7/23", bidHoras: 2, timeLog: 3.00, assetType: "Cry Babies", project: "Cry Babies" },
            { id: 45466, link: "ss03_ep001_sq010_sh0030", episodeName: "ss03_ep001", taskName: "Layout", pipelineStep: "Layout", startDate: "23/7/23", dueDate: "29/7/23", duration: 5.00, assignedTo: "Alba Montejano", status: "apr", dateCreated: "4/7/23", bidHoras: 2, timeLog: 1.00, assetType: "Cry Babies", project: "Cry Babies" },
            { id: 45502, link: "ss03_ep001_sq010_sh0040", episodeName: "ss03_ep001", taskName: "Layout", pipelineStep: "Layout", startDate: "23/7/23", dueDate: "29/7/23", duration: 5.00, assignedTo: "Alba Montejano", status: "apr", dateCreated: "4/7/23", bidHoras: 2, timeLog: 2.00, assetType: "Cry Babies", project: "Cry Babies" },
            { id: 45436, link: "ss03_ep001_sq010_sh0050", episodeName: "ss03_ep001", taskName: "Layout", pipelineStep: "Layout", startDate: "23/7/23", dueDate: "29/7/23", duration: 5.00, assignedTo: "Alba Montejano", status: "apr", dateCreated: "4/7/23", bidHoras: 2, timeLog: 3.00, assetType: "Cry Babies", project: "Cry Babies" },
            { id: 45472, link: "ss03_ep001_sq010_sh0060", episodeName: "ss03_ep001", taskName: "Layout", pipelineStep: "Layout", startDate: "23/7/23", dueDate: "29/7/23", duration: 5.00, assignedTo: "Alba Montejano", status: "apr", dateCreated: "4/7/23", bidHoras: 2, timeLog: 4.00, assetType: "Cry Babies", project: "Cry Babies" },
            { id: 45490, link: "ss03_ep001_sq010_sh0070", episodeName: "ss03_ep001", taskName: "Layout", pipelineStep: "Layout", startDate: "23/7/23", dueDate: "29/7/23", duration: 5.00, assignedTo: "Alba Montejano", status: "apr", dateCreated: "4/7/23", bidHoras: 2, timeLog: 4.00, assetType: "Cry Babies", project: "Cry Babies" },
            { id: 45442, link: "ss03_ep001_sq010_sh0080", episodeName: "ss03_ep001", taskName: "Layout", pipelineStep: "Layout", startDate: "23/7/23", dueDate: "29/7/23", duration: 5.00, assignedTo: "Alba Montejano", status: "apr", dateCreated: "4/7/23", bidHoras: 2, timeLog: 3.00, assetType: "Cry Babies", project: "Cry Babies" },
            { id: 45460, link: "ss03_ep001_sq010_sh0090", episodeName: "ss03_ep001", taskName: "Layout", pipelineStep: "Layout", startDate: "23/7/23", dueDate: "29/7/23", duration: 5.00, assignedTo: "Alba Montejano", status: "apr", dateCreated: "4/7/23", bidHoras: 2, timeLog: 3.00, assetType: "Cry Babies", project: "Cry Babies" },
            { id: 45400, link: "ss03_ep001_sq010_sh0100", episodeName: "ss03_ep001", taskName: "Layout", pipelineStep: "Layout", startDate: "23/7/23", dueDate: "29/7/23", duration: 5.00, assignedTo: "Alba Montejano", status: "apr", dateCreated: "4/7/23", bidHoras: 2, timeLog: 3.00, assetType: "Cry Babies", project: "Cry Babies" },
            { id: 45394, link: "ss03_ep001_sq010_sh0110", episodeName: "ss03_ep001", taskName: "Layout", pipelineStep: "Layout", startDate: "23/7/23", dueDate: "29/7/23", duration: 5.00, assignedTo: "Alba Montejano", status: "apr", dateCreated: "4/7/23", bidHoras: 2, timeLog: 1.00, assetType: "Cry Babies", project: "Cry Babies" },
            { id: 45412, link: "ss03_ep001_sq010_sh0130", episodeName: "ss03_ep001", taskName: "Layout", pipelineStep: "Layout", startDate: "23/7/23", dueDate: "29/7/23", duration: 5.00, assignedTo: "Alba Montejano", status: "apr", dateCreated: "4/7/23", bidHoras: 2, timeLog: 2.00, assetType: "Cry Babies", project: "Cry Babies" },
            { id: 45508, link: "ss03_ep001_sq010_sh0140", episodeName: "ss03_ep001", taskName: "Layout", pipelineStep: "Layout", startDate: "23/7/23", dueDate: "29/7/23", duration: 5.00, assignedTo: "Alba Montejano", status: "apr", dateCreated: "4/7/23", bidHoras: 2, timeLog: 2.00, assetType: "Cry Babies", project: "Cry Babies" },
            { id: 45496, link: "ss03_ep001_sq010_sh0150", episodeName: "ss03_ep001", taskName: "Layout", pipelineStep: "Layout", startDate: "23/7/23", dueDate: "29/7/23", duration: 5.00, assignedTo: "Alba Montejano", status: "apr", dateCreated: "4/7/23", bidHoras: 2, timeLog: 4.00, assetType: "Cry Babies", project: "Cry Babies" },
            { id: 45430, link: "ss03_ep001_sq010_sh0160", episodeName: "ss03_ep001", taskName: "Layout", pipelineStep: "Layout", startDate: "23/7/23", dueDate: "29/7/23", duration: 5.00, assignedTo: "Alba Montejano", status: "apr", dateCreated: "4/7/23", bidHoras: 2, timeLog: 4.00, assetType: "Cry Babies", project: "Cry Babies" },
            { id: 45484, link: "ss03_ep001_sq010_sh0170", episodeName: "ss03_ep001", taskName: "Layout", pipelineStep: "Layout", startDate: "23/7/23", dueDate: "29/7/23", duration: 5.00, assignedTo: "Alba Montejano", status: "apr", dateCreated: "4/7/23", bidHoras: 2, timeLog: 4.00, assetType: "Cry Babies", project: "Cry Babies" },
            { id: 45406, link: "ss03_ep001_sq010_sh0180", episodeName: "ss03_ep001", taskName: "Layout", pipelineStep: "Layout", startDate: "23/7/23", dueDate: "29/7/23", duration: 5.00, assignedTo: "Alba Montejano", status: "apr", dateCreated: "4/7/23", bidHoras: 2, timeLog: 4.00, assetType: "Cry Babies", project: "Cry Babies" },
            // Agregando más datos para el análisis
            { id: 45448, link: "ss03_ep001_sq010_sh0190", episodeName: "ss03_ep001", taskName: "Layout", pipelineStep: "Layout", startDate: "23/7/23", dueDate: "29/7/23", duration: 5.00, assignedTo: "Alba Montejano", status: "apr", dateCreated: "4/7/23", bidHoras: 2, timeLog: 1.00, assetType: "Cry Babies", project: "Cry Babies" },
            { id: 45556, link: "ss03_ep001_sq020_sh0010", episodeName: "ss03_ep001", taskName: "Layout", pipelineStep: "Layout", startDate: "23/7/23", dueDate: "29/7/23", duration: 5.00, assignedTo: "Mónica Martínez", status: "apr", dateCreated: "8/7/23", bidHoras: 2, timeLog: 4.00, assetType: "Cry Babies", project: "Cry Babies" },
            { id: 45574, link: "ss03_ep001_sq020_sh0020", episodeName: "ss03_ep001", taskName: "Layout", pipelineStep: "Layout", startDate: "23/7/23", dueDate: "29/7/23", duration: 5.00, assignedTo: "Mónica Martínez", status: "apr", dateCreated: "8/7/23", bidHoras: 2, timeLog: 3.00, assetType: "Cry Babies", project: "Cry Babies" },
            { id: 45568, link: "ss03_ep001_sq020_sh0030", episodeName: "ss03_ep001", taskName: "Layout", pipelineStep: "Layout", startDate: "23/7/23", dueDate: "29/7/23", duration: 5.00, assignedTo: "Mónica Martínez", status: "apr", dateCreated: "8/7/23", bidHoras: 2, timeLog: 3.00, assetType: "Cry Babies", project: "Cry Babies" },
            { id: 45562, link: "ss03_ep001_sq020_sh0040", episodeName: "ss03_ep001", taskName: "Layout", pipelineStep: "Layout", startDate: "23/7/23", dueDate: "29/7/23", duration: 5.00, assignedTo: "Mónica Martínez", status: "apr", dateCreated: "8/7/23", bidHoras: 2, timeLog: 4.00, assetType: "Cry Babies", project: "Cry Babies" },
            { id: 45592, link: "ss03_ep001_sq020_sh0050", episodeName: "ss03_ep001", taskName: "Layout", pipelineStep: "Layout", startDate: "23/7/23", dueDate: "29/7/23", duration: 5.00, assignedTo: "Mónica Martínez", status: "apr", dateCreated: "8/7/23", bidHoras: 2, timeLog: 1.00, assetType: "Cry Babies", project: "Cry Babies" },
            { id: 45580, link: "ss03_ep001_sq020_sh0070", episodeName: "ss03_ep001", taskName: "Layout", pipelineStep: "Layout", startDate: "23/7/23", dueDate: "29/7/23", duration: 5.00, assignedTo: "Mónica Martínez", status: "apr", dateCreated: "8/7/23", bidHoras: 2, timeLog: 2.00, assetType: "Cry Babies", project: "Cry Babies" },
            { id: 45640, link: "ss03_ep001_sq030_sh0010", episodeName: "ss03_ep001", taskName: "Layout", pipelineStep: "Layout", startDate: "23/7/23", dueDate: "29/7/23", duration: 5.00, assignedTo: "Mónica Martínez", status: "apr", dateCreated: "8/7/23", bidHoras: 2, timeLog: 4.00, assetType: "Cry Babies", project: "Cry Babies" },
            { id: 45616, link: "ss03_ep001_sq030_sh0020", episodeName: "ss03_ep001", taskName: "Layout", pipelineStep: "Layout", startDate: "23/7/23", dueDate: "29/7/23", duration: 5.00, assignedTo: "Mónica Martínez", status: "apr", dateCreated: "8/7/23", bidHoras: 2, timeLog: 3.00, assetType: "Cry Babies", project: "Cry Babies" }
        ];

        // --- Procesamiento de Datos ---

        // 1. Artista con más horas gastadas (time log)
        const hoursByArtist = data.reduce((acc, item) => {
            acc[item.assignedTo] = (acc[item.assignedTo] || 0) + item.timeLog;
            return acc;
        }, {});
        const sortedArtists = Object.entries(hoursByArtist).sort(([, a], [, b]) => b - a);
        const artistWithMostHours = sortedArtists.length > 0 ? sortedArtists[0][0] : "N/A";
        const maxHoursValue = sortedArtists.length > 0 ? sortedArtists[0][1] : 0;

        // 2. Total de horas presupuestadas (bid horas)
        const totalBidHours = data.reduce((sum, item) => sum + item.bidHoras, 0);

        // 3. Pipeline step que excede en horas BID vs. time log
        const pipelineHours = data.reduce((acc, item) => {
            if (!acc[item.pipelineStep]) {
                acc[item.pipelineStep] = { bid: 0, log: 0 };
            }
            acc[item.pipelineStep].bid += item.bidHoras;
            acc[item.pipelineStep].log += item.timeLog;
            return acc;
        }, {});

        let pipelineWithExcess = "Ninguno";
        for (const step in pipelineHours) {
            if (pipelineHours[step].log > pipelineHours[step].bid) {
                pipelineWithExcess = step;
                break; // Tomamos el primero que encontramos
            }
        }

        // 4. Promedio de horas gastadas por pipeline step
        const avgLogHoursPerPipeline = {};
        for (const step in pipelineHours) {
            avgLogHoursPerPipeline[step] = pipelineHours[step].log / data.filter(d => d.pipelineStep === step).length;
        }

        // 5. Distribución de horas log por fecha/mes
        // Asumiendo que 'dateCreated' es la fecha relevante para la evolución temporal
        const logHoursByMonth = data.reduce((acc, item) => {
            // Parsear la fecha para obtener el mes
            const dateParts = item.dateCreated.split('/');
            const month = parseInt(dateParts[1], 10); // Mes 1-12
            const year = parseInt(dateParts[2], 10);
            const monthYear = `${month}/${year}`; // Formato MM/YYYY para agrupar

            if (!acc[monthYear]) {
                acc[monthYear] = 0;
            }
            acc[monthYear] += item.timeLog;
            return acc;
        }, {});

        // Ordenar meses para la línea temporal
        const sortedMonths = Object.keys(logHoursByMonth).sort((a, b) => {
            const [monthA, yearA] = a.split('/').map(Number);
            const [monthB, yearB] = b.split('/').map(Number);
            if (yearA !== yearB) return yearA - yearB;
            return monthA - monthB;
        });
        const orderedLogHoursByMonth = sortedMonths.map(month => ({
            month: month,
            hours: logHoursByMonth[month]
        }));

        // 6. Distribución de status de tareas
        const taskStatus = data.reduce((acc, item) => {
            acc[item.status] = (acc[item.status] || 0) + 1;
            return acc;
        }, {});

        // --- Actualizar los elementos de la página ---
        document.getElementById('artist-max-hours').textContent = `${artistWithMostHours} (${maxHoursValue.toFixed(2)}h)`;
        document.getElementById('total-bid-hours').textContent = `${totalBidHours}h`;
        document.getElementById('pipeline-excess').textContent = pipelineWithExcess !== "Ninguno" ? `${pipelineWithExcess} (Superado)` : "Ninguno";
        if (pipelineWithExcess !== "Ninguno") {
            document.getElementById('pipeline-excess').classList.add('highlight');
        } else {
             document.getElementById('pipeline-excess').classList.remove('highlight');
        }


        // --- Configuración de Gráficos ---

        // Gráfico 1: Horas BID vs. Horas LOG por Pipeline Step
        const bidVsLogHoursCtx = document.getElementById('bidVsLogHoursChart').getContext('2d');
        new Chart(bidVsLogHoursCtx, {
            type: 'bar',
            data: {
                labels: Object.keys(pipelineHours),
                datasets: [
                    {
                        label: 'Horas BID',
                        data: Object.keys(pipelineHours).map(step => pipelineHours[step].bid),
                        backgroundColor: 'rgba(54, 162, 235, 0.6)', // Azul
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Horas LOG',
                        data: Object.keys(pipelineHours).map(step => pipelineHours[step].log),
                        backgroundColor: 'rgba(255, 99, 132, 0.6)', // Rojo
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'Comparativa Horas BID vs. Horas LOG por Pipeline Step'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Horas'
                        }
                    }
                }
            }
        });

        // Gráfico 2: Promedio de horas gastadas por pipeline step
        const avgLogHoursPerPipelineCtx = document.getElementById('avgLogHoursPerPipelineChart').getContext('2d');
        new Chart(avgLogHoursPerPipelineCtx, {
            type: 'bar',
            data: {
                labels: Object.keys(avgLogHoursPerPipeline),
                datasets: [{
                    label: 'Promedio Horas LOG',
                    data: Object.values(avgLogHoursPerPipeline),
                    backgroundColor: 'rgba(75, 192, 192, 0.6)', // Verde azulado
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'Promedio de Horas Gastadas por Pipeline Step'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Promedio de Horas'
                        }
                    }
                }
            }
        });

        // Gráfico 3: Distribución de horas log por fecha/mes
        const logHoursByDateCtx = document.getElementById('logHoursByDateChart').getContext('2d');
        new Chart(logHoursByDateCtx, {
            type: 'line',
            data: {
                labels: orderedLogHoursByMonth.map(item => item.month),
                datasets: [{
                    label: 'Horas LOG Acumuladas por Mes',
                    data: orderedLogHoursByMonth.map(item => item.hours),
                    borderColor: 'rgba(153, 102, 255, 1)', // Morado
                    backgroundColor: 'rgba(153, 102, 255, 0.2)',
                    fill: true,
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'Evolución de Horas Gastadas por Mes'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Total Horas LOG'
                        }
                    }
                }
            }
        });

        // Gráfico 4: Distribución de Status de Tareas
        const taskStatusCtx = document.getElementById('taskStatusDistributionChart').getContext('2d');
        const statusLabels = Object.keys(taskStatus);
        const statusData = Object.values(taskStatus);
        const statusBackgroundColors = [
            'rgba(255, 159, 64, 0.6)', // Naranja
            'rgba(75, 192, 192, 0.6)',  // Verde azulado
            'rgba(54, 162, 235, 0.6)',  // Azul
            'rgba(201, 203, 207, 0.6)', // Gris
            'rgba(153, 102, 255, 0.6)' // Morado
        ];
        const statusBorderColors = [
            'rgba(255, 159, 64, 1)',
            'rgba(75, 192, 192, 1)',
            'rgba(54, 162, 235, 1)',
            'rgba(201, 203, 207, 1)',
            'rgba(153, 102, 255, 1)'
        ];

        new Chart(taskStatusCtx, {
            type: 'pie',
            data: {
                labels: statusLabels,
                datasets: [{
                    label: 'Número de Tareas',
                    data: statusData,
                    backgroundColor: statusBackgroundColors.slice(0, statusLabels.length), // Ajustar colores si hay más labels
                    borderColor: statusBorderColors.slice(0, statusLabels.length),
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'Distribución de Tareas por Status'
                    },
                    legend: {
                        position: 'top',
                    }
                }
            }
        });

    </script>

</body>
</html>